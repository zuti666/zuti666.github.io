---
layout: post
title:  Continual Learning  Try to analyze and understand Noise 1
categories: [Continual Learning,  math, MachineLearning, LoRA ]
description: 
keywords: [Continual Learning, math, MachineLearning, LoRA ]
---

# Continual Learning  Try to Analyze Noise 1



# ç¬¦å·è¡¨è¿°

æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªå…¸å‹çš„**ç›‘ç£å­¦ä¹ é—®é¢˜**ï¼Œè®¾å®šå¦‚ä¸‹ï¼š

- è¾“å…¥ç©ºé—´ä¸º $\mathcal{X}$ï¼Œè¾“å‡ºç©ºé—´ä¸º $\mathcal{Y}$ï¼›

- æ ·æœ¬å¯¹ $(x, y) \in \mathcal{X} \times \mathcal{Y}$ æœä»æŸä¸ª**æœªçŸ¥çš„æ•°æ®ç”Ÿæˆåˆ†å¸ƒ** $\mathcal{D}$ï¼›

- ç»™å®šä¸€ä¸ª**è®­ç»ƒæ ·æœ¬é›†**ï¼š
  $$
  S = \{(x_1, y_1), (x_2, y_2), \dots, (x_n, y_n)\} \sim \mathcal{D}^n
  $$
  å³ $n$ ä¸ªæ ·æœ¬æ˜¯ç‹¬ç«‹åŒåˆ†å¸ƒé‡‡æ ·å¾—åˆ°çš„ã€‚

------

æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ª**å‡è®¾ç©ºé—´** $\mathcal{F}$ï¼Œå…¶ä¸­æ¯ä¸ª $f \in \mathcal{F}$ æ˜¯ä»è¾“å…¥åˆ°è¾“å‡ºçš„é¢„æµ‹æ¨¡å‹ã€‚

æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª**æŸå¤±å‡½æ•°**ï¼š
$$
\ell: \mathcal{F} \times \mathcal{X} \times \mathcal{Y} \to [0, 1]
$$
å…¶ä½œç”¨æ˜¯è¯„ä¼°æŸä¸ªæ¨¡å‹ $f$ åœ¨æŸä¸ªæ ·æœ¬ $(x, y)$ ä¸Šçš„é¢„æµ‹è¯¯å·®ã€‚

ä¾‹å¦‚ï¼š

- è‹¥ $\ell(f, x, y) = \mathbf{1}[f(x) \neq y]$ï¼Œåˆ™ä¸º $0$â€“$1$ æŸå¤±ï¼›
- æˆ‘ä»¬å°†å…¶æ³›åŒ–ä¸ºä»»æ„åœ¨åŒºé—´ $[0, 1]$ ä¸Šæœ‰ç•Œçš„æŸå¤±å‡½æ•°ã€‚

------

# ğŸ“Œ å®šä¹‰ç»éªŒé£é™©ä¸æœŸæœ›é£é™©

å¯¹äºä¸€ä¸ªå›ºå®šçš„æ¨¡å‹ $f \in \mathcal{F}$ï¼š

- **æœŸæœ›é£é™©ï¼ˆæ³›åŒ–è¯¯å·®ï¼‰**ä¸ºï¼š
  $$
  \mathcal{L}_{\mathcal{D}}(f) := \mathbb{E}_{(x, y) \sim \mathcal{D}}[\ell(f, x, y)]
  $$
  
- **ç»éªŒé£é™©ï¼ˆè®­ç»ƒè¯¯å·®ï¼‰**ä¸ºï¼š

- $$
  \mathcal{L}_S(f) := \frac{1}{n} \sum_{i=1}^n \ell(f, x_i, y_i)
  $$

  

#  PAC-Bayesian Model Selection

### å®šç†å½¢å¼ï¼ˆPAC-Bayes â€œmodel selection folk theoremâ€ï¼‰

å¯¹äºæ‰€æœ‰çš„ $f_i \in \mathcal{F}$ï¼Œä»¥è‡³å°‘ $1 - \delta$ çš„æ¦‚ç‡æˆç«‹ï¼š
$$
\mathcal{L}_{\mathcal{D}}(f_i) \leq \mathcal{L}_S(f_i) + \sqrt{ \frac{1}{2m} \left( \log \frac{1}{P(f_i)} + \log \frac{1}{\delta} \right) }
\tag{1}
$$

------

### ğŸ“Œ ç¬¦å·è§£é‡Šï¼š

| ç¬¦å·                             | å«ä¹‰                                            |
| -------------------------------- | ----------------------------------------------- |
| $\mathcal{L}_{\mathcal{D}}(f_i)$ | æ¨¡å‹ $f_i$ çš„æ³›åŒ–è¯¯å·®                           |
| $\mathcal{L}_S(f_i)$             | æ¨¡å‹ $f_i$ åœ¨è®­ç»ƒé›†ä¸Šçš„ç»éªŒè¯¯å·®                 |
| $P(f_i)$                         | æ¨¡å‹ $f_i$ çš„å…ˆéªŒæ¦‚ç‡ï¼Œè¶Šå°è¯´æ˜è¶Šä¸è¢«â€œå…ˆéªŒä¿¡ä»»â€ |
| $\delta$                         | ç½®ä¿¡æ°´å¹³ï¼ˆPAC ä¿è¯ï¼‰                            |
| $m$                              | è®­ç»ƒæ ·æœ¬æ•°é‡                                    |

------



## âœ… å®šç†ç›´è§‚è§£é‡Šï¼š

è¿™ä¸ªç•Œé™è¯´æ˜ï¼š

- å¯¹äºä»»ä½•ä¸€ä¸ªæ¨¡å‹ $f_i$ï¼Œå…¶åœ¨**æ•´ä¸ªæ•°æ®åˆ†å¸ƒä¸‹çš„æ³›åŒ–è¯¯å·®**ä¸ä¼šè¿œç¦»å®ƒåœ¨è®­ç»ƒé›†ä¸Šçš„è¯¯å·®ï¼›
- åå·®å¤§å°å—ä¸¤éƒ¨åˆ†æ§åˆ¶ï¼š
  1. $\log \frac{1}{P(f_i)}$ï¼šæ¨¡å‹è¶Šä¸è¢«å…ˆéªŒä¿¡ä»»ï¼Œæƒ©ç½šè¶Šå¤§ï¼›
  2. $\log \frac{1}{\delta}$ï¼šæˆ‘ä»¬æƒ³è¦è¶Šé«˜ç½®ä¿¡åº¦ï¼ˆè¶Šå° $\delta$ï¼‰ï¼Œä»£ä»·è¶Šå¤§ã€‚

------

## ğŸ¤– PAC-Bayes æ¨¡å‹é€‰æ‹©ç®—æ³•

ç”±ä¸ç­‰å¼ (1) å¼•å‡ºä¸€ç§ç®€å•çš„æ¨¡å‹é€‰æ‹©æ–¹æ³•ï¼š

**é€‰æ‹©ä¸€ä¸ªä½¿ä¸Šç•Œæœ€å°çš„æ¨¡å‹ $f^*$ï¼š**
$$
f^* = \arg\min_{f_i \in \mathcal{F}} \left[ \mathcal{L}_S(f_i) + \sqrt{ \frac{1}{2m} \left( \log \frac{1}{P(f_i)} + \log \frac{1}{\delta} \right) } \right] 
\tag{2}
$$
è¿™è¡¨æ˜æˆ‘ä»¬ä¸ä»…ä»…é€‰æ‹©è®­ç»ƒè¯¯å·®æœ€ä½çš„æ¨¡å‹ï¼Œè€Œæ˜¯è¦åœ¨è®­ç»ƒè¯¯å·®ä¸æ¨¡å‹å¤æ‚åº¦ä¹‹é—´åšæƒè¡¡ã€‚å¤æ‚åº¦é€šè¿‡**å…ˆéªŒåˆ†å¸ƒ $P$** ç¼–ç ï¼Œä¹Ÿå°±æ˜¯å¼•å…¥äº†ä¸€ç§**ä¿¡æ¯è®ºæ„ä¹‰ä¸Šçš„ Occamâ€™s Razorï¼ˆå¥¥å¡å§†å‰ƒåˆ€ï¼‰**ã€‚



# PAC-Bayesian Model Averaging ï¼ˆMcAllester 1999ï¼‰

åœ¨ä¸Šä¸€èŠ‚æˆ‘ä»¬æåˆ°çš„æ˜¯**PAC-Bayes æ¨¡å‹é€‰æ‹©**ï¼Œå³å¯¹æ¯ä¸ªå•ç‹¬æ¨¡å‹ $f \in \mathcal{F}$ ç»™å‡ºä¸€ä¸ªé£é™©ä¸Šç•Œã€‚è€Œæœ¬æ–‡çš„æ ¸å¿ƒç»“æœæ˜¯å°†è¯¥æ¡†æ¶æ¨å¹¿åˆ°**æ¦‚ç‡åˆ†å¸ƒ $Q$ ä¸Šçš„æ¨¡å‹å¹³å‡ï¼ˆmodel averagingï¼‰**ã€‚

## ğŸ“Œ å¼•å…¥æ¦‚ç‡æ¨¡å‹åˆ†å¸ƒï¼ˆPAC-Bayes æ¡†æ¶ï¼‰

åœ¨ PAC-Bayes æ¡†æ¶ä¸‹ï¼Œæˆ‘ä»¬ä¸é€‰å®šä¸€ä¸ªå…·ä½“æ¨¡å‹ $f$ï¼Œè€Œæ˜¯è€ƒè™‘ä¸€ä¸ª**åéªŒåˆ†å¸ƒ $Q$ å®šä¹‰åœ¨ $\mathcal{F}$ ä¸Š**ï¼Œå³ï¼š

- ä» $Q$ ä¸­é‡‡æ ·ä¸€ä¸ªæ¨¡å‹ $f \sim Q$ï¼Œç„¶åç”¨å®ƒè¿›è¡Œé¢„æµ‹ï¼›

- è¿™æ ·æˆ‘ä»¬å®šä¹‰ï¼š

  - **åˆ†å¸ƒ $Q$ çš„æœŸæœ›é£é™©**ä¸ºï¼š
    $$
    \mathcal{L}_{\mathcal{D}}(Q) := \mathbb{E}_{f \sim Q} \left[ \mathcal{L}_{\mathcal{D}}(f) \right] \tag{3}
    $$
  
- **åˆ†å¸ƒ $Q$ çš„ç»éªŒé£é™©**ä¸ºï¼š
  
- $$
    \mathcal{L}_S(Q) := \mathbb{E}_{f \sim Q} \left[ \mathcal{L}_S(f) \right]  \tag{4}
    $$

  

æˆ‘ä»¬è¿˜å‡è®¾å­˜åœ¨ä¸€ä¸ª**å…ˆéªŒåˆ†å¸ƒ $P$ï¼ˆæ•°æ®æ— å…³ï¼‰**ï¼Œä¹Ÿæ˜¯å®šä¹‰åœ¨ $\mathcal{F}$ ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒï¼Œè¡¨ç¤ºæˆ‘ä»¬åœ¨è§‚å¯Ÿæ•°æ®ä¹‹å‰å¯¹æ¨¡å‹çš„ä¿¡å¿µã€‚

æˆ‘ä»¬åœ¨ä»¥ä¸‹è®¾å®šä¸‹å»ºç«‹ä¸»å®šç†ï¼š

- $\mathcal{F}$ ä¸ºå‡è®¾ç©ºé—´ï¼Œ$f \in \mathcal{F}$ ä¸ºé¢„æµ‹å‡½æ•°ï¼›
- $P$ æ˜¯å®šä¹‰åœ¨ $\mathcal{F}$ ä¸Šçš„**å…ˆéªŒåˆ†å¸ƒ**ï¼Œåœ¨è§‚å¯Ÿæ•°æ®å‰ç»™å‡ºï¼›
- $Q$ æ˜¯åœ¨è®­ç»ƒé›† $S$ ç»™å‡ºåæ„å»ºçš„**åéªŒåˆ†å¸ƒ**ï¼›
- æŸå¤±å‡½æ•° $\ell(f, x, y) \in [0, 1]$ ä¸ºæœ‰ç•Œå¯æµ‹å‡½æ•°ï¼›
- æ ·æœ¬é›† $S = {(x_1, y_1), \dots, (x_n, y_n)} \sim \mathcal{D}^n$ï¼›
- æ‰€æœ‰é£é™©éƒ½ä»¥æœŸæœ›æŸå¤±è¡¨ç¤ºï¼š
  - $\mathcal{L}_S(Q) = \mathbb{E}_{f \sim Q} \left[ \frac{1}{n} \sum_{i=1}^n \ell(f, x_i, y_i) \right]$ï¼›
  - $\mathcal{L}_{\mathcal{D}}(Q) = \mathbb{E}_{f \sim Q} \left[ \mathbb{E}_{(x,y) \sim \mathcal{D}} [\ell(f,x,y)] \right]$ã€‚

------

### ğŸ“Œ KL æ•£åº¦å®šä¹‰

ä¸ºäº†åº¦é‡åéªŒ $Q$ åç¦»å…ˆéªŒ $P$ çš„ç¨‹åº¦ï¼Œæˆ‘ä»¬ä½¿ç”¨**Kullback-Leibler æ•£åº¦**ï¼š


$$
\mathrm{KL}(Q \| P) := \sum_{f \in \mathcal{F}} Q(f) \cdot \log \frac{Q(f)}{P(f)}  \tag{5}
$$
è¯¥é¡¹è¶Šå¤§ï¼Œè¡¨ç¤ºæ¨¡å‹ $Q$ å¯¹è®­ç»ƒé›†ä¾èµ–è¶Šå¼ºï¼ˆè¶Šå¤æ‚ï¼‰ï¼Œåœ¨æ³›åŒ–ç•Œä¸­èµ·åˆ°â€œæ­£åˆ™é¡¹â€ä½œç”¨ã€‚

------

### âš ï¸ ä¿®å‰ªï¼ˆPrunedï¼‰åˆ†å¸ƒçš„æŠ€æœ¯æ€§å®šä¹‰

ä¸ºäº†ç®€åŒ–åˆ†æï¼Œæœ¬æ–‡ä»…è€ƒè™‘ä¸€ç±»ç‰¹æ®Šçš„ $Q$ï¼š

> å¦‚æœæŸä¸ªæ¨¡å‹ $f$ æ»¡è¶³ $Q(f) > 0$ï¼Œåˆ™è¦æ±‚ $P(f) > 0$ï¼›å¦åˆ™ $Q(f) = 0$ã€‚

å³ï¼š**åéªŒåˆ†å¸ƒçš„æ”¯æŒé›†å¿…é¡»åŒ…å«åœ¨å…ˆéªŒåˆ†å¸ƒçš„æ”¯æŒé›†å†…ã€‚**

æˆ‘ä»¬ç§°è¿™ç±» $Q$ ä¸º**ä¿®å‰ªåˆ†å¸ƒï¼ˆpruned distributionsï¼‰**ã€‚è¿™æ˜¯ä¸ºäº†é¿å…åœ¨ KL ä¸­å‡ºç° $\log \frac{Q(f)}{P(f)}$ çš„é™¤ä»¥ 0 æƒ…å†µã€‚

ä½†ç†è®ºä½œè€…æŒ‡å‡ºï¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ä¸ªé™åˆ¶**å‡ ä¹ä¸ä¼šå½±å“ä¸»æµåéªŒåˆ†å¸ƒçš„æ•ˆæœ**ï¼Œå› ä¸ºï¼š

- å¦‚è¯­è¨€å»ºæ¨¡æˆ–å†³ç­–æ ‘å­¦ä¹ ç­‰åº”ç”¨ä¸­ï¼ŒåéªŒå¾€å¾€é›†ä¸­åœ¨å°‘é‡é«˜å®¹é‡æ¨¡å‹ä¸Šï¼›
- è¿™äº›æ¨¡å‹è™½ç„¶å…ˆéªŒ $P(f)$ éå¸¸å°ï¼Œä½†åéªŒ $Q(f)$ å¾ˆå¤§ï¼ˆå› ä¸ºæ•°æ®æ”¯æŒå¼ºï¼‰ï¼›
- æ‰€ä»¥å¯¹ä½æ¦‚ç‡æ¨¡å‹è¿›è¡Œâ€œä¿®å‰ªâ€ä¸ä¼šå½±å“å¤§éƒ¨åˆ† $Q$ çš„è´¨é‡ã€‚

------

## âœ… PAC-Bayes ä¸Šç•Œå®šç†

> **Theorem 1 (PAC-Bayesian Bound on Expected Loss of $Q$):**

å¯¹æ‰€æœ‰æ»¡è¶³ä¸Šè¿°â€œä¿®å‰ªæ¡ä»¶â€çš„åéªŒåˆ†å¸ƒ $Q$ï¼Œä»¥è‡³å°‘ $1 - \delta$ çš„æ¦‚ç‡ï¼Œæœ‰ï¼š
$$
\mathcal{L}_{\mathcal{D}}(Q) \leq \mathcal{L}_S(Q) + \frac{1}{m - 1} \left[ \mathrm{KL}(Q \| P) + \log \frac{m}{\delta}  \right] 

\tag{6}
$$

> æ³¨æ„ä¸Šé¢å…¬å¼$(2)$ å’Œä¹‹å‰çš„å…¬å¼ $(1)$çš„åŒºåˆ« 
> $$
> \mathcal{L}_{\mathcal{D}}(f_i) \leq \mathcal{L}_S(f_i) + \sqrt{ \frac{1}{2n} \left( \log \frac{1}{P(f_i)} + \log \frac{1}{\delta} \right) }
> \tag{1}
> $$
> æ ¹æ®ä¸Šé¢çš„å®šä¹‰$(3), (4)$ï¼Œå…¬å¼ $(6)$å¯ä»¥é‡æ–°è¡¨è¿°ä¸º
> $$
> \mathbb{E}_{f \sim Q} \left[ \mathcal{L}_{\mathcal{D}}(f) \right] 
> \leq 
> \mathbb{E}_{f \sim Q} \left[ \mathcal{L}_S(f) \right] + \frac{1}{n - 1} \left[ \mathrm{KL}(Q \| P) + \log \frac{1}{\delta} + 4 \log n + 8 \right] 
> 
> \tag{6-2}
> $$
> æˆ‘ä»¬å°±å¯ä»¥æ¸…æ™°åœ°å¯¹æ¯”PAC-Bayesian Model Averagingå’Œä¹‹å‰çš„æ¨¡å‹é€‰æ‹©çš„ä¸åŒäº†ï¼Œ è¿™é‡Œæè¿°çš„åœ¨æŸä¸ªåˆ†å¸ƒ$Q$ä¸‹å¯¹æ¨¡å‹$f$ ä» $\mathcal{F}$è¿›è¡Œé‡‡æ · çš„è¡¨ç°ï¼Œè€Œä¸æ˜¯ä»…ä»…å…³å¿ƒä¸€ä¸ªå…·ä½“çš„$f$





### ğŸ“– è§£é‡Šå„éƒ¨åˆ†å«ä¹‰ï¼š

| é¡¹                             | å«ä¹‰                                                   |
| ------------------------------ | ------------------------------------------------------ |
| $\mathcal{L}_{\mathcal{D}}(Q)$ | åéªŒ $Q$ çš„æœŸæœ›æ³›åŒ–è¯¯å·®                                |
| $\mathcal{L}_S(Q)$             | åéªŒ $Q$ çš„è®­ç»ƒè¯¯å·®ï¼ˆç»éªŒé£é™©ï¼‰                        |
| $\mathrm{KL}(Q | P)$           | åéªŒå¯¹å…ˆéªŒçš„åç¦»ç¨‹åº¦                                   |
| $\log \frac{1}{\delta}$        | æ§åˆ¶ç½®ä¿¡åº¦çš„é¡¹ï¼Œè¶Šå°è¶Šç¨³å¥                             |
| $4 \log n + 8$                 | æ¥è‡ªå¯¹æœŸæœ›å’Œé‡‡æ ·çš„ concentration boundï¼Œå…·ä½“æ¨å¯¼è§åŸæ–‡ |
| $n$                            | æ ·æœ¬æ•°é‡                                               |

------

### ğŸ§  ç›´è§‚ç†è§£ï¼š

è¿™ä¸€å®šç†ç»™å‡ºçš„ç»“è®ºæ˜¯ï¼š

> **åªè¦ä½ é€‰å®šçš„åéªŒåˆ†å¸ƒ $Q$ ä¸å¤ªå¤æ‚ï¼ˆKL ä¸å¤§ï¼‰ï¼Œå¹¶åœ¨è®­ç»ƒé›†ä¸Šè¡¨ç°å¥½ï¼Œé‚£ä¹ˆå®ƒåœ¨æ•´ä¸ªåˆ†å¸ƒä¸Šçš„æ³›åŒ–è¯¯å·®ä¹Ÿå¯ä»¥å¾—åˆ°æ§åˆ¶ã€‚**

è¿™ä¸ºä½¿ç”¨æ¨¡å‹åˆ†å¸ƒï¼ˆè€Œéå•ä¸ªæ¨¡å‹ï¼‰è¿›è¡Œé¢„æµ‹æä¾›äº†åšå®çš„ç†è®ºåŸºç¡€ã€‚




$$
\mathbb{E}_{f \sim Q} \left[ \mathcal{L}_{\mathcal{D}}(f) \right] 
\leq 
\mathbb{E}_{f \sim Q} \left[ \hat{\mathcal{L}}_S(f) \right] + 
\sqrt{\frac{D(Q\|P)+ \ln \frac{1}{\delta}+\ln m+2}{2m-1}}
$$


**any measurable loss function $l$**

a possibly uncountable set $F$

$Q$ ranges over all distributions (measures) on $F$
















$$
Q^*(\theta) = \frac{\pi(\theta) \cdot \exp(-n \cdot \hat{L}_S(\theta))}{Z_{S}}
$$
